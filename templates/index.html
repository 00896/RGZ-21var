{% extends "base.html" %}

{#–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç: #}
{% block main %}
    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="user-panel">
        {% if session.get('username') %}
            <span style="text-align: left; margin-right: 670px; margin-left: 10px">–í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <strong>{{ session['username'] }}</strong></span>
            {% if session.get('is_admin') %}
                <a href="{{ url_for('admin_panel') }}" class="button">–ê–¥–º–∏–Ω-—Ç–∞–±–ª–∏—Ü—ã</a>
            {% endif %}
            <a href="{{ url_for('new_initiative') }}" class="button">–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É</a>
            <form method="POST" action="{{ url_for('logout') }}" style="display: inline;width:100px">
                <button type="submit" class="button">–í—ã–π—Ç–∏</button>
            </form>
        {% else %}
            <a href="{{ url_for('login') }}" style="margin-left: 1220px" class="button">–í–æ–π—Ç–∏</a>
            <a href="{{ url_for('register') }}" class="button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
    </div>

    
    <h1>–°–ø–∏—Å–æ–∫ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤</h1>
    <br>
    
    {% for initiative in initiatives %}
    <div>
        <h2>{{ initiative['title'] }}</h2>
        <div style="margin-bottom:15px; margin-left:55px;font-size:18px">{{ initiative['content'] }}</div>
        <div style="margin-bottom:15px; margin-left:10px"><i>–ê–≤—Ç–æ—Ä: {{ initiative['username'] or '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' }}</i></div>
        
        <div style="margin-bottom:15px; margin-left:10px">–ì–æ–ª–æ—Å–∞: {{ initiative['total_votes'] }}</div>
        
        <div class="vote-delete-buttons">
            {% if session.get('user_id') %}
                {% set user_vote = get_db().execute("SELECT vote_type FROM votes WHERE user_id = ? AND initiative_id = ?", (session['user_id'], initiative['id'])).fetchone() %}
                
                <a href="{{ url_for('vote', id=initiative['id'], vote_type='up') }}" class="button {% if user_vote and user_vote['vote_type'] == 'up' %}voted{% endif %}">üëç</a>
                <a href="{{ url_for('vote', id=initiative['id'], vote_type='down') }}" class="button {% if user_vote and user_vote['vote_type'] == 'down' %}voted{% endif %}">üëé</a>
                
                {% if session['user_id'] == initiative['author_id'] or session.get('is_admin') %}
                    <a href="{{ url_for('delete_initiative', id=initiative['id']) }}" class="button">–£–¥–∞–ª–∏—Ç—å</a>
                {% endif %}
            {% endif %}
        </div>
    </div>
    <hr>
    {% endfor %}
    
    {% if page > 1 %}
        <a href="{{ url_for('index', page=page-1) }}" class="button">–ù–∞–∑–∞–¥</a>
    {% endif %}
    {% if has_more %}
        <a href="{{ url_for('index', page=page+1) }}" class="button">–ï—â—ë</a>
    {% endif %}
    {% endblock %}